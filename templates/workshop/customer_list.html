{% extends 'base/base.html' %}
{% load crispy_forms_tags %}


{% block meta_title %} Serwis | Klienci {% endblock %}
{% block script %}

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var deleteButtons = document.querySelectorAll('button[id^="deleteButton"]');
            var confirmDeleteButton = document.getElementById('confirmDelete');
            var closeModalButtons = document.querySelectorAll('[data-dismiss="modal"]');
            var targetForm = null;

            deleteButtons.forEach(function (button) {
                button.addEventListener('click', function (event) {
                    event.preventDefault();
                    targetForm = document.getElementById(button.dataset.formId);
                    $('#confirmDeleteModal').modal('show');
                });
            });

            confirmDeleteButton.addEventListener('click', function () {
                if (targetForm) {
                    targetForm.submit();
                }
            });

            closeModalButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    $('#confirmDeleteModal').modal('hide');
                });
            });
        });
    </script>

{% endblock %}
{% block content %}

    <a href="{% url 'workshop:customer-create' %}">Stwórz klienta</a>

    <form method="GET" action="">
        {% csrf_token %}
        <div class="form-row align-items-center">
            <div class="col">
                <div>{{ q|crispy }}</div>
            </div>
        </div>
        <button class="btn btn-primary form-control" type="submit">Szukaj</button>
    </form>


    <div class="table-responsive mt-5">
        <table class="table table-hover">
            <thead>
            <tr>
                <th scope="col">Imie i nazwisko</th>
                <th scope="col">Email</th>
                <th scope="col">Numer telefonu</th>
                <th scope="col">Edytuj</th>
                <th scope="col">Usuń</th>
            </tr>
            </thead>
            <tbody>
            {% for object in object_list %}
                <tr>
                    <td><a href="{% url 'workshop:customer-detail' object.id %}">{{ object.name }}</a></td>
                    <td><a href="mailto:{{ object.email }}">{{ object.email }}</a></td>
                    <td>{{ object.phone }}</td>
                    <td><a href="{% url 'workshop:customer-update' object.id %}">Edytuj</a></td>
                    <td>
                        <div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog"
                             aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="confirmDeleteModalLabel">Potwierdzenie
                                            usunięcia</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Zamknij">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Czy na pewno chcesz usunąć ten element?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Nie
                                        </button>
                                        <button type="button" class="btn btn-danger" id="confirmDelete">Tak</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                      <form id="deleteForm-{{ object.id }}" action="{% url 'workshop:customer-delete' object.id %}"
                              method="POST">
                            {% csrf_token %}
                            <button id="deleteButton-{{ object.id }}" data-form-id="deleteForm-{{ object.id }}"
                                    class="btn btn-danger" type="button">Usuń
                            </button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


    {% include "base/pagination.html" %}
{% endblock %}